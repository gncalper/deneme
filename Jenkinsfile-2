pipeline {
    agent any

    stages {
        stage('Update a.txt and Git Push') {
            steps {
                lock(resource: 'git-push-lock') {
                    script {
                        echo "Lock acquired â€” updating a.txt and pushing to Git..."

                        withCredentials([gitUsernamePassword(credentialsId: 'alper', gitToolName: 'Default')]) {
                            sh """
                                git fetch origin master
                                git rebase origin/master
                                sed -i "s/^a=.*/a=${BUILD_NUMBER}/" a.txt
                                git add .
                                git commit -m "change"
                                git push origin HEAD:master
                            """
                        }
                    }
                }
            }
        }
    }
}
