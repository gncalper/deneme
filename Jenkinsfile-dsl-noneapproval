pipeline {
    agent any

    parameters {
        string(name: 'WORKSPACE', description: 'Workspace adı')
        string(name: 'PROJECT', description: 'Project adı')
        choice(name: 'NAMESPACE', choices: ['uat', 'prod'], description: 'Ortam')
    }

    stages {
        stage('Validate input') {
            steps {
                script {
                    if (!params.WORKSPACE?.trim()) {
                        error 'WORKSPACE boş olamaz'
                    }
                    if (!params.PROJECT?.trim()) {
                        error 'PROJECT boş olamaz'
                    }
                }
            }
        }

        stage('Run Job DSL') {
            steps {
                jobDsl(
                    targets: 'dsl/create_noneapproval.groovy',
                    additionalParameters: [
                        WORKSPACE: params.WORKSPACE,
                        PROJECT  : params.PROJECT,
                        NAMESPACE: params.NAMESPACE
                    ]
                )
            }
        }
    }
}
